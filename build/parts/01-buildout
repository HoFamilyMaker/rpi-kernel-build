#!/bin/bash -ex

export DEBIAN_FRONTEND=noninteractive
export USE_HARDFLOAT=${USE_HARDFLOAT:-"YES"}

# Install build deps
apt-get update
apt-get install -y build-essential git patch make bc

# Install the gnueabi version for the type of float we want (softfp v. hardfp)
( [[ "${USE_HARDFLOAT}" == "YES" ]] && apt-get install -y gcc-4.7-arm-linux-gnueabihf ) ||
( [[ "${USE_HARDFLOAT}" != "YES" ]] && apt-get install -y gcc-4.7-arm-linux-gnueabi )

# Link gcc-4.7 to gcc, if it's not already done
( [[ ! -L /usr/bin/arm-linux-gnueabihf-gcc ]] && [[ "${USE_HARDFLOAT}" == "YES" ]] && \
    ( ln -s /usr/bin/arm-linux-gnueabihf-gcc-4.7 /usr/bin/arm-linux-gnueabihf-gcc ) ) ||
( [[ ! -L /usr/bin/arm-linux-gnueabi-gcc ]] && [[ "${USE_HARDFLOAT}" != "YES" ]] && \
    ( ln -s /usr/bin/arm-linux-gnueabi-gcc-4.7 /usr/bin/arm-linux-gnueabi-gcc ) )